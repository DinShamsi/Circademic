<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circademic - 爪专 拽砖专</title>
    <link rel="icon" href="favicon2.png" type="image/png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&family=Rubik:wght@600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lucide@0.395.0/dist/umd/lucide.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <style>
        /* Design System Variables ( -index.html) */
        :root {
            --primary: #3B82F6; --primary-light: #60A5FA; --primary-dark: #2563EB;
            --secondary: #8B5CF6; --secondary-light: #A78BFA; --secondary-dark: #7C3AED;
            --accent: #F59E0B; --accent-light: #FBBF24; --accent-dark: #D97706;
            --success: #10B981; --success-light: #34D399; --success-dark: #059669;
            --bg-light: #F9FAFB; --bg-lighter: #FFFFFF; --bg-dark: #0F172A;
            --bg-darker: #030712; --bg-dark-card: #1E293B;
            --text-primary-light: #111827; --text-secondary-light: #6B7280;
            --text-primary-dark: #F9FAFB; --text-secondary-dark: #9CA3AF;
            --border-light: #E5E7EB; --border-dark: #374151;
            --radius-md: 12px; --radius-lg: 16px; --radius-xl: 20px;
        }

        body { 
            font-family: 'Heebo', sans-serif;
            background: var(--bg-light);
        }
        body.dark { background: var(--bg-dark); }
        h1, h2, h3 { font-family: 'Rubik', sans-serif; font-weight: 700; }
        
        /*  砖专 住转 -index.html */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .sidebar { background: white; box-shadow: 4px 0 10px rgba(0, 0, 0, 0.05); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 40; }
        .dark .sidebar { background: var(--bg-dark-card); box-shadow: 4px 0 10px rgba(0, 0, 0, 0.3); }
        @media (max-width: 768px) {
            .sidebar { position: fixed; top: 0; right: -100%; height: 100vh; width: 280px; }
            .sidebar.open { right: 0; }
        }
        .dashboard-card { background: white; border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); border: 1px solid rgba(59, 130, 246, 0.1); animation: fadeInUp 0.5s ease-out; }
        .dark .dashboard-card { background: var(--bg-dark-card); border-color: rgba(59, 130, 246, 0.2); box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); }
        .stat-number { background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .nav-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: var(--radius-md); color: var(--text-secondary-light); text-decoration: none; transition: all 0.2s ease; cursor: pointer; }
        .nav-item:hover { background: rgba(59, 130, 246, 0.1); color: var(--primary); transform: translateX(-4px); }
        .nav-item.active { background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(139, 92, 246, 0.15)); color: var(--primary); font-weight: 600; }
        .dark .nav-item { color: var(--text-secondary-dark); }
        .dark .nav-item:hover { background: rgba(59, 130, 246, 0.2); color: var(--primary-light); }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 0.75rem 1.5rem; border-radius: var(--radius-md); font-weight: 600; border: none; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 14px rgba(59, 130, 246, 0.4); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(59, 130, 246, 0.5); }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }
        .mobile-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 35; }
        .mobile-overlay.active { display: block; }
        .loading { display: flex; align-items: center; justify-content: center; height: 100vh; }
        .spinner { width: 50px; height: 50px; border: 4px solid rgba(59, 130, 246, 0.1); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .user-avatar { width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: 700; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }
        .badge { display: inline-block; padding: 0.25rem 0.75rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; }
        .badge.new { background: linear-gradient(135deg, var(--accent), var(--accent-dark)); }
        
        /* 住转 住驻爪驻 驻住 爪专转 拽砖专 */
        .input-field, select, textarea {
            padding: 0.75rem 1rem; border: 2px solid var(--border-light); border-radius: var(--radius-md);
            background: var(--bg-light); transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.938rem; width: 100%;
        }
        .input-field:focus, select:focus, textarea:focus {
            outline: none; border-color: var(--primary); background: white;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        .dark .input-field, .dark select, .dark textarea {
            background: var(--bg-darker); border-color: var(--border-dark); color: var(--text-primary-dark);
        }
        .dark .input-field:focus, .dark select:focus, .dark textarea:focus {
            background: var(--bg-dark); border-color: var(--primary-light);
        }
        label {
            display: block; text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2;
        }
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900">
    
    <div id="loading-screen" class="loading">
        <div class="spinner"></div>
    </div>

    <div id="app" class="hidden">
        
        <button id="mobile-menu-toggle" class="md:hidden fixed top-4 left-4 z-50 p-3 bg-white dark:bg-gray-800 rounded-full shadow-lg">
            <i data-lucide="menu" class="w-5 h-5 text-gray-700 dark:text-gray-300"></i>
        </button>

        <div id="mobile-overlay" class="mobile-overlay"></div>

        <div class="flex min-h-screen">
            
            <aside id="sidebar" class="sidebar w-64 flex-shrink-0 md:relative md:translate-x-0">
                <div class="p-6 h-full flex flex-col">
                    
                    <div class="mb-8">
                        <div class="flex items-center gap-3 mb-6">
                            <img src="LOGO.png" alt="Logo" class="w-12 h-12">
                            <h1 class="text-2xl font-bold stat-number">Circademic</h1>
                        </div>
                        
                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-4">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="user-avatar" id="user-avatar">
                                    <span id="user-initial">?</span>
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-800 dark:text-gray-200" id="user-name">注...</p>
                                    <p class="text-sm text-gray-600 dark:text-gray-400" id="user-email">...</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button id="profile-settings" class="text-xs px-3 py-1 bg-white dark:bg-gray-700 rounded-lg hover:shadow-md transition-all">
                                    <i data-lucide="settings" class="w-3 h-3 inline ml-1"></i>
                                    专转
                                </button>
                                <button id="logout-btn" class="text-xs px-3 py-1 bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-400 rounded-lg hover:shadow-md transition-all">
                                    <i data-lucide="log-out" class="w-3 h-3 inline ml-1"></i>
                                    爪
                                </button>
                            </div>
                        </div>
                    </div>

                    <nav class="flex-1">
                        <a href="/" class="nav-item">
                            <i data-lucide="home" class="w-5 h-5"></i>
                            <span> 拽专</span>
                        </a>
                        <a href="AcademicStatus.html" class="nav-item">
                            <i data-lucide="graduation-cap" class="w-5 h-5"></i>
                            <span>注拽 拽</span>
                        </a>
                        <a href="#" class="nav-item" id="schedule-link">
                            <i data-lucide="calendar" class="w-5 h-5"></i>
                            <span>注专转 砖注转</span>
                            <span class="badge new mr-auto">拽专</span>
                        </a>
                        <a href="#" class="nav-item" id="notes-link">
                            <i data-lucide="file-text" class="w-5 h-5"></i>
                            <span>住 住转</span>
                            <span class="badge new mr-auto">拽专</span>
                        </a>
                        <a href="#" class="nav-item" id="tasks-link">
                            <i data-lucide="check-square" class="w-5 h-5"></i>
                            <span>砖转</span>
                            <span class="badge new mr-auto">拽专</span>
                        </a>
                        
                        <hr class="my-4 border-gray-200 dark:border-gray-700">
                        
                        <a href="contact.html" class="nav-item active"> <i data-lucide="send" class="w-5 h-5"></i>
                            <span>爪专 拽砖专</span>
                        </a>
                        <a href="about.html" class="nav-item">
                            <i data-lucide="info" class="w-5 h-5"></i>
                            <span>转 注专转</span>
                        </a>

                    </nav>

                    <div class="mt-auto pt-4 border-t border-gray-200 dark:border-gray-700">
                        <button id="dark-mode-toggle" class="nav-item w-full">
                            <i data-lucide="moon" class="w-5 h-5 block dark:hidden"></i>
                            <i data-lucide="sun" class="w-5 h-5 hidden dark:block"></i>
                            <span>爪 </span>
                        </button>
                    </div>
                </div>
            </aside>

            <main class="flex-1 p-4 md:p-8 overflow-y-auto">
                
                <header class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-200 mb-2">
                        爪专 拽砖专
                    </h2>
                    <p class="text-gray-600 dark:text-gray-400">
                        砖  砖? 爪注 砖驻专?  住转 专爪  砖? 砖 砖注 !
                    </p>
                </header>

                <div class="dashboard-card max-w-2xl mx-auto">
                    <form id="contact-form" class="space-y-6">
                        
                        <div id="message-container"></div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="contact-name">砖 </label>
                                <input type="text" id="contact-name" class="input-field" required>
                            </div>
                            <div>
                                <label for="contact-email">转转 </label>
                                <input type="email" id="contact-email" class="input-field" required>
                            </div>
                        </div>

                        <div>
                            <label for="contact-subject">砖 驻</label>
                            <select id="contact-subject" class="input-field" required>
                                <option value="" disabled selected>专 砖...</option>
                                <option value=" 注 转拽"> 注 转拽</option>
                                <option value="爪注 驻爪'专">爪注 驻爪'专</option>
                                <option value="砖 转">砖 转</option>
                                <option value_value="专">专</option>
                            </select>
                        </div>

                        <div>
                            <label for="contact-message">注 砖</label>
                            <textarea id="contact-message" rows="6" class="input-field" placeholder="转  转 注转..." required></textarea>
                        </div>

                        <div>
                            <button type="submit" id="submit-btn" class="btn-primary w-full md:w-auto">
                                <span id="submit-btn-text">砖 注</span>
                                <span id="submit-spinner" class="loading-spinner hidden"></span>
                            </button>
                        </div>
                    </form>
                </div>
            </main>
        </div>
    </div>

    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white dark:bg-gray-800 rounded-xl p-8 max-w-md w-full" style="animation: fadeInUp 0.3s ease-out;">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-6">专转 驻专驻</h2>
            <form id="settings-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">砖 </label>
                    <input type="text" id="settings-name" class="input-field w-full">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">住 </label>
                    <input type="text" id="settings-institution" class="input-field w-full">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">转 </label>
                    <input type="text" id="settings-major" class="input-field w-full">
                </div>
                <div class="flex gap-4 pt-4">
                    <button type="submit" class="btn-primary flex-1">砖专 砖</button>
                    <button type="button" id="close-settings" class="flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-all"></button>
                </div>
            </form>
        </div>
    </div>


    <script>
        // Firebase Configuration ()
        const firebaseConfig = {
            apiKey: "AIzaSyDj1V85FXrcZ8Tg1kezkTsO50bgMOLcnPk",
            authDomain: "circademic-582dc.firebaseapp.com",
            projectId: "circademic-582dc",
            storageBucket: "circademic-582dc.firebasestorage.app",
            messagingSenderId: "296566462689",
            appId: "1:296566462689:web:d23a6f74078de2332bbfa0",
            measurementId: "G-SPD143KGDK"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global Variables
        let currentUser = null;
        let userData = null;
        let academicData = null;

        // DOM Elements
        const loadingScreen = document.getElementById('loading-screen');
        const app = document.getElementById('app');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const sidebar = document.getElementById('sidebar');
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const mobileOverlay = document.getElementById('mobile-overlay');
        const settingsModal = document.getElementById('settings-modal');
        const profileSettingsBtn = document.getElementById('profile-settings');
        const closeSettingsBtn = document.getElementById('close-settings');
        const settingsForm = document.getElementById('settings-form');
        
        // --- DOM Elements 砖 ---
        const contactForm = document.getElementById('contact-form');
        const messageContainer = document.getElementById('message-container');
        const submitBtn = document.getElementById('submit-btn');

        // Auth State Observer
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                await loadUserData();
                await loadAcademicData();
                updateUserProfile();
                
                initializePage(); // 驻拽爪 转 祝
                
                loadingScreen.classList.add('hidden');
                app.classList.remove('hidden');
            } else {
                window.location.href = 'login.html';
            }
        });

        // --- 驻拽爪转 注转 转 (转 -index) ---
        async function loadUserData() {
            try {
                const doc = await db.collection('users').doc(currentUser.uid).get();
                if (doc.exists) {
                    userData = doc.data();
                }
            } catch (error) { console.error('Error loading user data:', error); }
        }
        async function loadAcademicData() {
             try {
                const doc = await db.collection('academicData').doc(currentUser.uid).get();
                if (doc.exists) {
                    academicData = doc.data();
                }
            } catch (error) { console.error('Error loading academic data:', error); }
        }
        function updateUserProfile() {
            const userName = userData?.name || academicData?.userInfo?.name || currentUser.displayName || '砖转砖';
            const userEmail = userData?.email || currentUser.email;
            const initial = userName.charAt(0).toUpperCase();
            document.getElementById('user-name').textContent = userName;
            document.getElementById('user-email').textContent = userEmail;
            document.getElementById('user-initial').textContent = initial;
            //  爪专 注 转 welcome-name 祝 
        }

        // --- 驻拽爪转 转 专砖转 祝 ---
        function initializePage() {
            lucide.createIcons();
            
            // 注转 爪 
            const darkMode = localStorage.getItem('theme') === 'dark';
            if (darkMode) {
                document.documentElement.classList.add('dark');
            }
            
            //   砖 驻住
            document.getElementById('contact-name').value = userData?.name || academicData?.userInfo?.name || currentUser.displayName || '';
            document.getElementById('contact-email').value = userData?.email || currentUser.email || '';
            
            //  驻住
            contactForm.addEventListener('submit', handleFormSubmit);
            
            // 驻注转  驻拽爪转 砖 转驻专 ( -index.html)
            setupSidebarControls();
        }
        
        // --- 驻拽爪 砖: 砖转 驻住 ---
        async function handleFormSubmit(e) {
            e.preventDefault();
            setLoading(true);
            clearMessages();

            const name = document.getElementById('contact-name').value;
            const email = document.getElementById('contact-email').value;
            const subject = document.getElementById('contact-subject').value;
            const message = document.getElementById('contact-message').value;

            if (!name || !email || !subject || !message) {
                showMessage('  转  砖转.', 'error');
                setLoading(false);
                return;
            }
            
            try {
                // 砖专 -Firestore
                await db.collection('contactSubmissions').add({
                    name: name,
                    email: email,
                    subject: subject,
                    message: message,
                    userId: currentUser.uid,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'new' //  注转
                });
                
                showMessage('注转 砖 爪! 爪专 转 拽砖专 拽.', 'success');
                contactForm.reset(); // 驻住 驻住
                //  砖 砖 驻专 砖转砖
                document.getElementById('contact-name').value = userData?.name || academicData?.userInfo?.name || currentUser.displayName || '';
                document.getElementById('contact-email').value = userData?.email || currentUser.email || '';

            } catch (error) {
                console.error("Error sending message:", error);
                showMessage('专注 砖 砖转 注. 住 砖 专 转专.', 'error');
            } finally {
                setLoading(false);
            }
        }
        
        // --- 驻拽爪转 注专 驻住 ---
        function setLoading(isLoading) {
            const textSpan = document.getElementById('submit-btn-text');
            const spinner = document.getElementById('submit-spinner');
            
            submitBtn.disabled = isLoading;
            if (isLoading) {
                textSpan.style.display = 'none';
                spinner.classList.remove('hidden');
            } else {
                textSpan.style.display = 'inline';
                spinner.classList.add('hidden');
            }
        }

        function showMessage(message, type = 'error') {
            const isError = type === 'error';
            messageContainer.innerHTML = `
                <div class="${isError ? 'bg-red-100 dark:bg-red-900 border-red-400 text-red-700 dark:text-red-300' : 'bg-green-100 dark:bg-green-900 border-green-400 text-green-700 dark:text-green-300'} border-r-4 p-4 rounded-lg" role="alert">
                    <p class="font-bold">${isError ? '砖' : '爪'}</p>
                    <p>${message}</p>
                </div>
            `;
        }
        
        function clearMessages() {
            messageContainer.innerHTML = '';
        }

        // --- 驻拽爪转 转驻专 (转 -index.html) ---
        function setupSidebarControls() {
            darkModeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme',
                    document.documentElement.classList.contains('dark') ? 'dark' : 'light'
                );
                lucide.createIcons();
            });

            mobileMenuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('open');
                mobileOverlay.classList.toggle('active');
            });

            mobileOverlay.addEventListener('click', () => {
                sidebar.classList.remove('open');
                mobileOverlay.classList.remove('active');
            });

            profileSettingsBtn.addEventListener('click', () => {
                settingsModal.classList.remove('hidden');
                settingsModal.classList.add('flex');
                document.getElementById('settings-name').value = userData?.name || academicData?.userInfo?.name || '';
                document.getElementById('settings-institution').value = userData?.institution || academicData?.userInfo?.institution || '';
                document.getElementById('settings-major').value = userData?.major || academicData?.userInfo?.major || '';
            });

            closeSettingsBtn.addEventListener('click', () => {
                settingsModal.classList.add('hidden');
                settingsModal.classList.remove('flex');
            });

            settingsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('settings-name').value;
                const institution = document.getElementById('settings-institution').value;
                const major = document.getElementById('settings-major').value;
                try {
                    await db.collection('users').doc(currentUser.uid).update({ name, institution, major });
                    await db.collection('academicData').doc(currentUser.uid).update({
                        'userInfo.name': name, 'userInfo.institution': institution, 'userInfo.major': major
                    });
                    if (name) await currentUser.updateProfile({ displayName: name });
                    if (userData) { userData.name = name; userData.institution = institution; userData.major = major; }
                    if (academicData) { academicData.userInfo.name = name; academicData.userInfo.institution = institution; academicData.userInfo.major = major; }
                    updateUserProfile();
                    settingsModal.classList.add('hidden');
                    settingsModal.classList.remove('flex');
                    alert('专转 砖专 爪!');
                } catch (error) {
                    console.error('Error updating profile:', error);
                    alert('专注 砖 砖专转 专转.');
                }
            });

            document.getElementById('logout-btn').addEventListener('click', async () => {
                if (confirm(' 转  砖专爪 爪转?')) {
                    try {
                        await auth.signOut();
                        window.location.href = 'login.html';
                    } catch (error) { console.error('Error signing out:', error); }
                }
            });

            document.querySelectorAll('#schedule-link, #notes-link, #tasks-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    alert('驻爪壮专    拽专! ');
                });
            });
        }
    </script>
</body>
</html>
