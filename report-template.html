<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Report Template</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&family=Rubik:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #3B82F6; --primary-light: #60A5FA;
            --secondary: #8B5CF6;
            --accent: #F59E0B;
            --success: #10B981;
            --bg-light: #F9FAFB;
            --text-primary: #111827; --text-secondary: #6B7280;
            --border-light: #E5E7EB;
            --radius-lg: 16px;
        }

        body {
            font-family: 'Heebo', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
            color: var(--text-primary);
        }

        .report-container {
            width: 210mm; /* A4 width */
            min-height: 297mm; /* A4 height */
            padding: 20mm;
            box-sizing: border-box;
            background: white;
        }

        /* Header */
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding-bottom: 1rem;
            border-bottom: 4px solid var(--primary);
            page-break-inside: avoid;
        }
        .report-header .user-details h1 {
            font-family: 'Rubik', sans-serif;
            font-size: 28px;
            color: var(--text-primary);
            margin: 0 0 5px 0;
        }
        .report-header .user-details p {
            font-family: 'Heebo', sans-serif;
            font-size: 16px;
            color: var(--text-secondary);
            margin: 0;
        }
        .report-header .logo {
            width: 80px;
            height: 80px;
        }

        /* Title */
        .report-title {
            font-family: 'Rubik', sans-serif;
            font-size: 36px;
            color: var(--primary);
            margin: 1.5rem 0;
            text-align: center;
            page-break-inside: avoid;
        }

        /* --- New Progress Bar Section --- */
        .progress-section {
            background-color: var(--bg-light);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            border: 1px solid var(--border-light);
            margin-bottom: 2rem;
            page-break-inside: avoid;
        }
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .progress-header h3 {
            font-family: 'Rubik', sans-serif;
            font-size: 20px;
            color: var(--text-primary);
            margin: 0;
        }
        .progress-header .badge {
            font-family: 'Rubik', sans-serif;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 1.25rem;
            font-weight: 700;
        }
        .progress-bar-container {
            width: 100%;
            height: 1.25rem; /* Taller bar */
            background: var(--border-light);
            border-radius: 9999px;
            overflow: hidden;
            position: relative;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 9999px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }
        .progress-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            font-family: 'Heebo', sans-serif;
            font-size: 16px;
            color: var(--text-secondary);
        }
        .progress-footer .value {
            font-family: 'Rubik', sans-serif;
            font-weight: 700;
            color: var(--text-primary);
        }
        /* --- End of Progress Bar Section --- */

        /* --- Symmetrical Details Grid --- */
        .details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
            align-items: flex-start; /* Aligns cards neatly */
        }
        .detail-card {
            background-color: var(--bg-light);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            border: 1px solid var(--border-light);
            page-break-inside: avoid; /* Tries to keep card on one page */
        }
        .detail-card h3 {
            font-family: 'Rubik', sans-serif;
            font-size: 20px;
            color: var(--text-primary);
            margin-top: 0;
            border-bottom: 2px solid var(--border-light);
            padding-bottom: 0.5rem;
        }
        .detail-card .chart-container {
            width: 100%;
            height: 250px; /* Adjusted height */
            margin-top: 1rem;
        }
        .detail-card .chart-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .detail-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .detail-list li {
            display: flex;
            justify-content: space-between;
            font-size: 15px;
            padding: 0.75rem 0;
            border-bottom: 1px dashed var(--border-light);
        }
        .detail-list li:last-child { border-bottom: none; }
        .detail-list li .label { color: var(--text-secondary); }
        .detail-list li .value { font-weight: 700; max-width: 60%; text-align: left; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}

        /* Full Course List */
        .full-course-list {
            page-break-before: always; /* Start table on a new page */
        }
        .full-course-list h3 {
            font-family: 'Rubik', sans-serif;
            font-size: 20px;
            color: var(--text-primary);
            margin-top: 0;
            border-bottom: 2px solid var(--border-light);
            padding-bottom: 0.5rem;
        }
        .course-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        .course-table th, .course-table td {
            padding: 0.75rem;
            text-align: right;
            border-bottom: 1px solid var(--border-light);
        }
        .course-table th {
            background-color: var(--bg-light);
            font-weight: 700;
            page-break-inside: avoid; /* Keep header with table */
        }
        .course-table td {
            page-break-inside: avoid; /* Try to keep rows intact */
        }
    </style>
</head>
<body>

    <div class="report-container" id="pdf-render-target">
        
        <header class="report-header">
            <div class="user-details">
                <h1>{{STUDENT_NAME}}</h1>
                <p>{{STUDENT_MAJOR}}</p>
                <p>{{STUDENT_INSTITUTION}}</p>
            </div>
            <img src="LOGO.png" alt="Circademic Logo" class="logo">
        </header>

        <h2 class="report-title">דוח מצב אקדמי</h2>

        <section class="progress-section">
            <div class="progress-header">
                <h3>התקדמות בתואר</h3>
                <span class="badge">{{PROGRESS_PERCENT}}%</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" style="width: {{PROGRESS_PERCENT}}%;"></div>
            </div>
            <div class="progress-footer">
                <span>
                    סה"כ נקודות זכות: 
                    <span class="value">{{TOTAL_CREDITS}} / {{REQUIRED_CREDITS}}</span>
                </span>
                <span>
                    ממוצע משוקלל: 
                    <span class="value">{{AVG_GRADE}}</span>
                </span>
            </div>
        </section>

        <section class="details-grid">
            
            <div class="detail-card">
                <h3>סיכום נתונים</h3>
                <ul class="detail-list">
                    <li>
                        <span class="label">ציון שיא:</span>
                        <span class="value" style="color: var(--success);" title="{{HIGHEST_GRADE_COURSE}} ({{HIGHEST_GRADE_SCORE}})">
                            {{HIGHEST_GRADE_COURSE}} ({{HIGHEST_GRADE_SCORE}})
                        </span>
                    </li>
                    <li>
                        <span class="label">ציון נמוך:</span>
                        <span class="value" style="color: #EF4444;" title="{{LOWEST_GRADE_COURSE}} ({{LOWEST_GRADE_SCORE}})">
                            {{LOWEST_GRADE_COURSE}} ({{LOWEST_GRADE_SCORE}})
                        </span>
                    </li>
                </ul>
                
                <h3 style="margin-top: 2rem;">ממוצעים סמסטריאליים</h3>
                <ul class="detail-list" id="semester-averages-list">
                    {{SEMESTER_AVERAGES_LIST}}
                </ul>
            </div>

            <div class="detail-card">
                <h3>מגמת ציונים</h3>
                <div class="chart-container">
                    <img src="{{GRADE_TREND_CHART_IMG}}" alt="גרף מגמת ציונים">
                </div>
                <h3 style="margin-top: 2rem;">התפלגות מועדים</h3>
                <div class="chart-container">
                    <img src="{{MOED_CHART_IMG}}" alt="גרף התפלגות מועדים">
                </div>
            </div>

        </section>

        <section class="full-course-list">
            <h3>רשימת קורסים מלאה</h3>
            <table class="course-table">
                <thead>
                    <tr>
                        <th>שם הקורס</th>
                        <th>סמסטר</th>
                        <th>נ"ז</th>
                        <th>ציון</th>
                        <th>מועד</th>
                    </tr>
                </thead>
                <tbody id="full-course-list-body">
                    {{FULL_COURSE_TABLE_ROWS}}
                </tbody>
            </table>
        </section>

    </div>

</body>
</html>
